<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>WaveSpeed Pro</title>
    <style>
        /* --- CORE VARIABLES --- */
        :root { 
            --bg: #0f172a; 
            --card: #1e293b; 
            --text: #f1f5f9; 
            --accent: #3b82f6; 
            --accent-hover: #60a5fa; 
            --input-bg: #334155; 
            --border: #475569; 
        }
        
        body { 
            margin: 0; 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
        }
        
        /* MAIN CARD */
        .app-container { 
            width: 90%; 
            max-width: 850px; 
            height: 95vh; 
            background: var(--card); 
            border-radius: 20px; 
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.7); 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            border: 1px solid var(--border); 
            transition: all 0.3s ease;
        }

        /* HEADER SECTION */
        .header { 
            padding: 25px; 
            background: rgba(15, 23, 42, 0.95); 
            border-bottom: 1px solid var(--border); 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
        }
        
        .controls-row { 
            display: flex; 
            gap: 15px; 
        }
        
        /* âœ¨ INTERACTIVE INPUTS & SELECTS âœ¨ */
        .nice-input { 
            flex: 1; 
            background: var(--input-bg); 
            border: 2px solid var(--border); 
            padding: 14px; 
            border-radius: 12px; 
            color: #fff; 
            outline: none; 
            font-size: 0.9rem;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        /* Hover Effect for Inputs */
        .nice-input:hover { 
            border-color: var(--accent-hover); 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); 
            background: #3c4d66;
        }

        /* Focus Effect for Inputs */
        .nice-input:focus { 
            border-color: var(--accent); 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3); 
            transform: translateY(-2px);
        }
        
        /* âœ¨ UPLOAD ZONE HOVER EFFECTS âœ¨ */
        .upload-label { 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: #ccc; 
            border: 2px dashed var(--border); 
            position: relative; 
            overflow: hidden;
            font-weight: 500;
        }

        .upload-label:hover { 
            border-color: var(--accent); 
            background: rgba(59, 130, 246, 0.1); 
            color: #fff; 
            transform: scale(1.02); 
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.15);
        }

        .upload-label.dragover { 
            background: rgba(59, 130, 246, 0.25); 
            border-color: var(--accent-hover); 
            color: white; 
            transform: scale(1.03); 
        }

        /* âœ¨ FILE LIST HOVER EFFECTS âœ¨ */
        #fileList { 
            display: flex; 
            flex-direction: column; 
            gap: 6px; 
            max-height: 100px; 
            overflow-y: auto; 
            margin-top: 5px; 
            padding-right: 5px;
        }

        .file-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            background: rgba(255, 255, 255, 0.05); 
            padding: 8px 12px; 
            border-radius: 8px; 
            font-size: 0.85rem; 
            border: 1px solid transparent;
            transition: all 0.2s ease;
            animation: slideDown 0.3s ease;
        }

        .file-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--border);
            transform: translateX(5px);
        }

        .remove-btn { 
            color: #ef4444; 
            cursor: pointer; 
            font-weight: bold; 
            padding: 4px 8px; 
            border-radius: 6px; 
            transition: all 0.2s; 
        }

        .remove-btn:hover { 
            background: #ef4444; 
            color: white; 
            transform: scale(1.1);
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* CHAT AREA */
        .chat-area { 
            flex: 1; 
            padding: 20px; 
            overflow-y: auto; 
            background: radial-gradient(circle at center, #243045, #1e293b); 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
        }

        .message { 
            max-width: 85%; 
            padding: 14px 18px; 
            border-radius: 16px; 
            line-height: 2.0; 
            font-size: 0.95rem; 
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .ai { align-self: flex-start; background: var(--input-bg); border: 1px solid var(--border); }
        .user { align-self: flex-end; background: linear-gradient(135deg, var(--accent), #2563eb); color: #fff; }
        .error { align-self: center; background: #ef4444; color: #fff; }
        
        @keyframes popIn { from{opacity:0; transform: scale(0.9) translateY(10px)} to{opacity:1; transform: scale(1) translateY(0)} }

        /* BOTTOM BAR & BUTTONS */
        .bottom-bar { 
            padding: 20px; 
            background: var(--card); 
            border-top: 1px solid var(--border); 
            display: flex; 
            gap: 15px; 
            align-items: center;
        }

        .prompt-input { 
            flex: 1; 
            padding: 16px; 
            border-radius: 12px; 
            background: var(--bg); 
            border: 2px solid var(--border); 
            color: #fff; 
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .prompt-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
        }

        /* âœ¨ SEND BUTTON HOVER âœ¨ */
        .send-btn { 
            background: var(--accent); 
            color: #fff; 
            border: none; 
            padding: 0 35px; 
            height: 54px;
            border-radius: 12px; 
            font-weight: 700; 
            letter-spacing: 0.5px;
            cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .send-btn:hover { 
            background: var(--accent-hover); 
            transform: translateY(-4px) scale(1.05); 
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.4); 
        }

        .send-btn:active {
            transform: translateY(-1px);
        }

        .send-btn:disabled { 
            background: var(--border); 
            cursor: not-allowed; 
            transform: none; 
            box-shadow: none;
        }

        /* CUSTOM SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <div class="controls-row">
            <input id="linkInput" class="nice-input" value="https://api.wavespeed.ai/api/v3/google/nano-banana-pro/edit">
            <input id="keyInput" class="nice-input" type="password" placeholder="API Key">
        </div>
        <div class="controls-row">
            <input id="imgInput" class="nice-input" placeholder="Image URL (optional)">
            
            <label class="nice-input upload-label" id="dropZone">
                <span id="fileName">ðŸ“‚ Drag Photos Here</span>
                <input type="file" id="fileInput" accept="image/*" multiple style="display:none">
            </label>

            <select id="aspect" class="nice-input">
                <option value="1:1">1:1 (Square)</option> 
                <option value="3:2">3:2 (Landscape)</option> 
                <option value="2:3">2:3 (Portrait)</option>
                <option value="4:3">4:3</option> 
                <option value="16:9">16:9 (Cinema)</option> 
                <option value="9:16">9:16 (Mobile)</option>
            </select>
        </div>
        
        <div id="fileList"></div>
        
        <div class="controls-row">
            <select id="resolution" class="nice-input">
                <option value="1k">1K Resolution</option>
                <option value="2k">2K Resolution</option>
            </select>
            <select id="format" class="nice-input">
                <option value="png">PNG</option>
                <option value="jpg">JPG</option>
                <option value="webp">WEBP</option>
            </select>
        </div>
    </div>

    <div class="chat-area" id="chat">
        <div class="message ai"><b>System Online.</b><br>Hover effects active. Ultra-Compression Ready.</div>
    </div>

    <div class="bottom-bar">
        <input id="userInput" class="prompt-input" placeholder="Describe what to do with these images...">
        <button id="sendBtn" class="send-btn">SEND</button>
    </div>
</div>

<script>
    // --- ELEMENTS ---
    const chat = document.getElementById("chat");
    const sendBtn = document.getElementById("sendBtn");
    const fileInput = document.getElementById("fileInput");
    const fileName = document.getElementById("fileName");
    const dropZone = document.getElementById("dropZone");
    const fileListContainer = document.getElementById("fileList");
    const imgInput = document.getElementById("imgInput");
    const keyInput = document.getElementById("keyInput");
    const linkInput = document.getElementById("linkInput");
    const userInput = document.getElementById("userInput");
    const aspect = document.getElementById("aspect");
    const resolution = document.getElementById("resolution");
    const format = document.getElementById("format");

    // âœ… LIVE SERVER URL
    const API = "https://wavespeedapp-api-7ce9.onrender.com/generate"; 

    // --- FILE HANDLING ---
    let allSelectedFiles = [];

    function handleFiles(files) {
        if (!files || files.length === 0) return;
        for (let i = 0; i < files.length; i++) { allSelectedFiles.push(files[i]); }
        renderFileList();
    }

    window.removeFile = function(index) {
        allSelectedFiles.splice(index, 1);
        renderFileList();
    };

    function renderFileList() {
        fileListContainer.innerHTML = "";
        if(allSelectedFiles.length === 0) {
            fileName.innerText = "ðŸ“‚ Drag Photos Here"; fileName.style.color = "#ccc"; return;
        }
        fileName.innerText = `âœ… ${allSelectedFiles.length} Images Added`; fileName.style.color = "#fff";
        
        allSelectedFiles.forEach((file, index) => {
            const div = document.createElement("div");
            div.className = "file-item";
            // Shorten name nicely
            const shortName = file.name.length > 20 ? file.name.substring(0, 18) + '...' : file.name;
            div.innerHTML = `<span>ðŸ“„ ${shortName}</span><span class="remove-btn" onclick="removeFile(${index})">âœ•</span>`;
            fileListContainer.appendChild(div);
        });
    }

    // Drag Effects
    dropZone.addEventListener("dragover", (e) => { 
        e.preventDefault(); 
        dropZone.classList.add("dragover"); 
        fileName.innerText = "ðŸ‘‡ Drop Now!";
    });
    dropZone.addEventListener("dragleave", () => { 
        dropZone.classList.remove("dragover"); 
        if(allSelectedFiles.length === 0) fileName.innerText = "ðŸ“‚ Drag Photos Here"; 
        else fileName.innerText = `âœ… ${allSelectedFiles.length} Images Added`;
    });
    dropZone.addEventListener("drop", (e) => { 
        e.preventDefault(); 
        dropZone.classList.remove("dragover"); 
        handleFiles(e.dataTransfer.files); 
    });
    fileInput.addEventListener('change', function() { handleFiles(this.files); this.value = ''; });

    function msg(html, type="ai"){
        const d = document.createElement("div"); d.className = `message ${type}`; d.innerHTML = html;
        chat.appendChild(d); chat.scrollTop = chat.scrollHeight; return d;
    }

    // ðŸ”¥ ULTRA COMPRESSOR (Max 800px, 60% Quality) - SAVES THE SERVER FROM CRASHING
    const compressAndConvert = (file) => {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (event) => {
                const img = new Image();
                img.src = event.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    const MAX_SIZE = 800; // Optimal for batching

                    if (width > height) {
                        if (width > MAX_SIZE) { height *= MAX_SIZE / width; width = MAX_SIZE; }
                    } else {
                        if (height > MAX_SIZE) { width *= MAX_SIZE / height; height = MAX_SIZE; }
                    }

                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    const dataUrl = canvas.toDataURL('image/jpeg', 0.6); // 60% Quality
                    resolve(dataUrl.split('base64,')[1]);
                };
                img.onerror = (err) => reject(err);
            };
            reader.onerror = (err) => reject(err);
        });
    };

    // --- SEND LOGIC ---
    sendBtn.onclick = async () => {
        const prompt = userInput.value.trim();
        if(!prompt) return alert("Please type instructions!");
        if(!keyInput.value) return alert("API Key is missing!");

        let finalImages = [];
        
        if(allSelectedFiles.length > 0) {
            msg(`Compressing ${allSelectedFiles.length} images...`, "ai");
            for (let i = 0; i < allSelectedFiles.length; i++) {
                try {
                    const b64 = await compressAndConvert(allSelectedFiles[i]);
                    finalImages.push(b64);
                } catch(err) {
                    return alert("Error processing file: " + err.message);
                }
            }
        } else if(imgInput.value.trim()) {
            finalImages.push(imgInput.value.trim());
        }

        if(finalImages.length === 0) return alert("Add at least one image.");

        sendBtn.disabled = true;
        msg(prompt, "user");
        const loader = msg(`Sending Job...`);

        try {
            const res = await fetch(API, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    apiKey: keyInput.value,
                    apiUrl: linkInput.value,
                    payload: {
                        prompt,
                        images: finalImages,
                        aspect_ratio: aspect.value,
                        resolution: resolution.value,
                        output_format: format.value,
                        enable_base64_output: true
                    }
                })
            });

            const contentType = res.headers.get("content-type");
            if (!contentType || !contentType.includes("application/json")) {
                throw new Error("Server Crash (Total size too big). Try fewer images.");
            }

            const data = await res.json();
            if(data.error) throw new Error(data.error);

            if(data.outputs && data.outputs.length > 0) {
                let html = "";
                data.outputs.forEach(output => {
                    let imgData = output.data || output;
                    if(typeof imgData === 'string' && imgData.includes('base64,')) imgData = imgData.split('base64,')[1];
                    html += `<img style="max-width:100%; border-radius:10px; margin-top:10px;" src="data:image/png;base64,${imgData}">`;
                });
                loader.innerHTML = html;
                allSelectedFiles = []; 
                renderFileList();
            } else {
                loader.innerText = "Finished, but no image returned.";
            }

        } catch(e) {
            loader.className = "message error";
            loader.innerText = e.message;
        }
        sendBtn.disabled = false;
    };
</script>
</body>
</html>